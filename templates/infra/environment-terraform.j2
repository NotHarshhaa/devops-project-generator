# Terraform environment configuration for {{ env }}

# Override variables for {{ env }} environment
variable "environment" {
  description = "Environment name"
  type        = string
  default     = "{{ env }}"
}

# Environment-specific configurations
{% if env == 'development' %}
variable "vpc_cidr" {
  description = "CIDR block for VPC"
  type        = string
  default     = "10.1.0.0/16"
}

variable "instance_count" {
  description = "Number of EC2 instances"
  type        = number
  default     = 1
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t3.micro"
}

{% elif env == 'staging' %}
variable "vpc_cidr" {
  description = "CIDR block for VPC"
  type        = string
  default     = "10.2.0.0/16"
}

variable "instance_count" {
  description = "Number of EC2 instances"
  type        = number
  default     = 2
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t3.small"
}

{% elif env == 'production' %}
variable "vpc_cidr" {
  description = "CIDR block for VPC"
  type        = string
  default     = "10.0.0.0/16"
}

variable "instance_count" {
  description = "Number of EC2 instances"
  type        = number
  default     = 3
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t3.medium"
}
{% endif %}

# Environment-specific tags
locals {
  env_tags = {
    Environment = "{{ env }}"
    CostCenter  = "{% if env == 'production' %}engineering{% else %}devops{% endif %}"
  }
}

# Environment-specific resources
{% if env == 'production' %}
# Enable enhanced monitoring in production
resource "aws_cloudwatch_metric_alarm" "memory_high" {
  alarm_name          = "${var.project_name}-memory-high-{{ env }}"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = "2"
  metric_name         = "MemoryUtilization"
  namespace           = "CWAgent"
  period              = "300"
  statistic           = "Average"
  threshold           = "85"
  alarm_description   = "This metric monitors memory utilization"
  alarm_actions       = [aws_sns_topic.alerts.arn]

  tags = merge(local.env_tags, {
    Name = "${var.project_name}-memory-alarm-{{ env }}"
  })
}
{% endif %}
